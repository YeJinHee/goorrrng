# 루돌프의 반란

## 문제

1번부터 P번까지 P 명의 산타들이 크리스마스 이브를 준비하던 중, 산타의 주요 수송수단인 루돌프가 반란을 일으켰습니다. 루돌프는 산타들을 박치기하여 산타의 선물 배달을 방해하려고 합니다. 산타들은 루돌프를 잡아서 크리스마스를 구해야 합니다!

(1) 게임판의 구성

게임판은 N×N 크기의 격자로 이루어져 있습니다. 각 위치는 (r, c)의 형태로 표현되며, 아래로 갈수록 r이 증가, 오른쪽으로 갈수록 c가 증가합니다. 좌상단은 (1, 1)입니다.

게임은 총 M 개의 턴에 걸쳐 진행되며 매 턴마다 루돌프와 산타들이 한 번씩 움직입니다. 루돌프가 한 번 움직인 뒤, 1번 산타부터 P번 산타까지 순서대로 움직이게 됩니다. 이때 기절해있거나 격자 밖으로 빠져나가 게임에서 탈락한 산타들은 움직일 수 없습니다.

게임판에서 두 칸 (r1, c1), (r2, c2) 사이의 거리는 (r1 − r2)^2+(c1 − c2)^2으로 계산됩니다.

(2) 루돌프의 움직임

루돌프는 가장 가까운 산타를 향해 1칸 돌진합니다. 단, 게임에서 탈락하지 않은 산타 중 가장 가까운 산타를 선택해야 합니다.

만약 가장 가까운 산타가 2명 이상이라면, r 좌표가 큰 산타를 향해 돌진합니다. r이 동일한 경우, c 좌표가 큰 산타를 향해 돌진합니다.

루돌프는 상하좌우, 대각선을 포함한 인접한 8방향 중 하나로 돌진할 수 있습니다. (편의상 인접한 대각선 방향으로 전진하는 것도 1칸 전진하는 것이라 생각합니다.) 가장 우선순위가 높은 산타를 향해 8방향 중 가장 가까워지는 방향으로 한 칸 돌진합니다.

(3) 산타의 움직임

산타는 1번부터 P번까지 순서대로 움직입니다.
기절했거나 이미 게임에서 탈락한 산타는 움직일 수 없습니다.
산타는 루돌프에게 거리가 가장 가까워지는 방향으로 1칸 이동합니다.
산타는 다른 산타가 있는 칸이나 게임판 밖으로는 움직일 수 없습니다.
움직일 수 있는 칸이 없다면 산타는 움직이지 않습니다.
움직일 수 있는 칸이 있더라도 만약 루돌프로부터 가까워질 수 있는 방법이 없다면 산타는 움직이지 않습니다.
산타는 상하좌우로 인접한 4방향 중 한 곳으로 움직일 수 있습니다. 이때 가장 가까워질 수 있는 방향이 여러 개라면, 상우하좌 우선순위에 맞춰 움직입니다.

(4) 충돌

산타와 루돌프가 같은 칸에 있게 되면 충돌이 발생합니다.
루돌프가 움직여서 충돌이 일어난 경우, 해당 산타는 C만큼의 점수를 얻게 됩니다. 이와 동시에 산타는 루돌프가 이동해온 방향으로 C 칸 만큼 밀려나게 됩니다.
산타가 움직여서 충돌이 일어난 경우, 해당 산타는 D만큼의 점수를 얻게 됩니다. 이와 동시에 산타는 자신이 이동해온 반대 방향으로 D 칸 만큼 밀려나게 됩니다.
밀려나는 것은 포물선 모양을 그리며 밀려나는 것이기 때문에 이동하는 도중에 충돌이 일어나지는 않고 정확히 원하는 위치에 도달하게 됩니다.
만약 밀려난 위치가 게임판 밖이라면 산타는 게임에서 탈락됩니다.
만약 밀려난 칸에 다른 산타가 있는 경우 상호작용이 발생합니다.

(5) 상호작용

루돌프와의 충돌 후 산타는 포물선의 궤적으로 이동하여 착지하게 되는 칸에서만 상호작용이 발생할 수 있습니다.
산타는 충돌 후 착지하게 되는 칸에 다른 산타가 있다면 그 산타는 1칸 해당 방향으로 밀려나게 됩니다. 그 옆에 산타가 있다면 연쇄적으로 1칸씩 밀려나는 것을 반복하게 됩니다. 게임판 밖으로 밀려나오게 된 산타의 경우 게임에서 탈락됩니다.

(6) 기절

산타는 루돌프와의 충돌 후 기절을 하게 됩니다. 현재가 k번째 턴이었다면, (k+1)번째 턴까지 기절하게 되어 (k+2)번째 턴부터 다시 정상상태가 됩니다.
기절한 산타는 움직일 수 없게 됩니다. 단, 기절한 도중 충돌이나 상호작용으로 인해 밀려날 수는 있습니다.
루돌프는 기절한 산타를 돌진 대상으로 선택할 수 있습니다.

(7) 게임 종료

M 번의 턴에 걸쳐 루돌프, 산타가 순서대로 움직인 이후 게임이 종료됩니다.
만약 P 명의 산타가 모두 게임에서 탈락하게 된다면 그 즉시 게임이 종료됩니다.
매 턴 이후 아직 탈락하지 않은 산타들에게는 1점씩을 추가로 부여합니다.
게임이 끝났을 때 각 산타가 얻은 최종 점수를 구하는 프로그램을 작성해보세요.

<br>

## 입력 형식

첫 번째 줄에 N, M, P, C, D가 공백을 사이에 두고 주어집니다.

다음 줄에는 루돌프의 초기 위치 (Rr, Rc) 가 주어집니다.

다음 P 개의 줄에 걸쳐서 산타의 번호 Pn과 초기 위치 (Sr, Sc)가 공백을 사이에 두고 주어집니다.

처음 산타와 루돌프의 위치는 겹쳐져 주어지지 않음을 가정해도 좋습니다.

- N: 게임판의 크기 (3 ≤ N ≤ 50)
- M: 게임 턴 수 (1 ≤ M ≤ 1000)
- P: 산타의 수 (1 ≤ P ≤ 30)
- C: 루돌프의 힘 (1 ≤ C ≤ N)
- D: 산타의 힘 (1 ≤ D ≤ N)
- Pn: 산타의 번호 (1 ≤ Pn ≤ P)
- (Rr, Rc): 루돌프의 초기 위치 (1 ≤ Rr, Rc ≤ N)
- (Sr, Sc): 산타의 초기 위치 (1 ≤ Sr, Sc ≤ N)

<br>

## 출력형식

게임이 끝났을 때 각 산타가 얻은 최종 점수를 1번부터 P번까지 순서대로 공백을 사이에 두고 출력합니다.

<br>

### 입출력 예제

#### 예제 1

입력 :

```
5 7 4 2 2
3 2
1 1 3
2 3 5
3 5 1
4 4 4
```

출력:

```
11 6 2 7
```

<br>

#### 예제 2

입력 :

```
5 10 5 1 2
5 5
2 1 4
1 3 2
4 2 4
5 1 3
3 5 3
```

출력:

```
8 14 15 12 12
```

<br>

## 예제 설명

1번 예제를 나타내면 다음과 같이 표현됩니다.
<img width="1405" alt="ade3988c-dc90-4f4e-8475-a619148a06e7" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/0158f91a-a0c3-4788-bab5-9df8040e72ab">

<br>

### 1번 턴 - 루돌프

루돌프는 거리가 가장 가까운 1, 3, 4번 산타 중 r 좌표가 가장 큰 3번 산타 쪽으로 이동하게 됩니다.
<img width="1476" alt="706b0d82-073c-4449-98b7-2e4ccbcec234" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/64315afa-e0f3-46ce-ae68-bc0429409d41">

<br>

### 1번 턴 - 산타

1, 2, 3, 4번 산타는 순서대로 이동하게 됩니다. 이동 결과 1, 3, 4번 산타는 루돌프와 가장 가까운 쪽으로 이동하게 되고, 3번 산타는 루돌프와 충돌하게 되어 2(=D)의 점수를 얻으면서 격자 밖으로 거리 2(=D)만큼 튕겨나가게 됩니다. 1번 턴이 종료된 이후 살아남은 산타는 1, 2, 4번 이므로 이들은 턴 종료와 함께 1점씩 점수를 얻게 됩니다.
<img width="1519" alt="38f7b164-9a90-4266-b167-fc75a247fa71" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/5eb2b828-250a-40a8-b5ff-f6eac12ae2e5">

<br>

### 2번 턴 - 루돌프

루돌프는 거리가 가장 가까운 4번 산타 쪽으로 이동하게 됩니다.
<img width="1476" alt="bb313537-a8be-4f32-9ae6-87f883debf45" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/0bc6659e-8829-44a9-8b9d-f846c7febd71">

<br>

### 2번 턴 - 산타

1, 2번 산타는 루돌프와 거리가 가장 가까운 쪽으로 이동하게 됩니다. 이때 1번 산타가 먼저 움직여 2번 산타가 왼쪽이 아닌 아래로 이동하였음에 유의합니다. 4번 산타는 루돌프와 충돌하게 되어 2점을 얻고 거리 2만큼 튕겨나가며, 동시에 2번 산타와 상호작용이 일어나 한 칸씩 밀리게 됩니다. 4번 산타는 이제 기절을 하게 되어 3번 턴까지 기절 상태가 유지됩니다. 살아남은 산타는 1, 3, 4번 이므로 이들은 턴 종료와 함께 1점씩 점수를 얻게 됩니다.
<img width="1446" alt="d81ee766-7322-47a9-80d3-4705b79c3b47" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/22ebd0eb-5c24-4135-8cf9-21df969194b1">

<img width="1446" alt="1ae0f334-e8bd-47be-a1ec-b608d678d9d2" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/f8377b26-1170-492a-8232-69a3659c6486">

<img width="1490" alt="aea00979-1ca9-4579-be7b-e161d9879dc8" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/399b282b-8573-45de-9433-037b2709926d">

<br>

### 3번 턴 - 루돌프

루돌프는 거리가 가장 가까운 1번 산타 쪽으로 이동하게 되어 1번 산타와 충돌합니다. 1번 산타는 루돌프와 충돌하게 되어 2(=C)의 점수를 얻으면서 격자 밖으로 거리 2(=C)만큼 튕겨나가게 됩니다. 1번 산타는 4번 턴까지 기절하게 됩니다.
<img width="1476" alt="92c53a12-9ac8-4cae-be6e-c4f8a6c97ee5" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/d80aea5a-04c6-49fd-a7f2-14c7a84ad28e">

<img width="1476" alt="e9c15e8f-8136-4ff5-8740-ff905cba5e76" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/01a40fa5-f874-4f58-9c36-dff058fe56cf">

<br>

### 3번 턴 - 산타

1, 4번 산타는 기절했기 때문에 움직일 수 없고, 2번 산타만 이동하게 됩니다. 살아남은 산타는 1, 3, 4번 이므로 이들은 턴 종료와 함께 1점씩 점수를 얻게 됩니다.
<img width="1446" alt="9a4cb685-1582-4e3a-9e86-ca565fa9aa2b" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/ac704e37-e1cf-4d8e-8814-ab96bb2d49fb">

<br>

### 4번 턴 - 루돌프

루돌프는 거리가 가장 가까운 4번 산타 쪽으로 이동하게 되어 4번 산타와 충돌합니다. 4번 산타는 2점을 얻고 격자 밖으로 튕겨 나가게 됩니다.
<img width="1476" alt="7533a49f-a238-4682-9c25-93f50f046698" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/875b8af8-e79c-4208-aba1-f9e91c1331a4">

<br>

### 4번 턴 - 산타

1번 산타는 기절했기 때문에 움직일 수 없고, 2번 산타만 이동하게 됩니다. 살아남은 산타는 1, 2번 이므로 이들은 턴 종료와 함께 1점씩 점수를 얻게 됩니다.
<img width="1446" alt="d8c13579-713c-4709-9fd1-d005618b5ec6" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/0acdbf0d-0bbc-4e9a-b6b3-40453af4a8da">

<br>

### 5번 턴 - 루돌프

루돌프는 거리가 가장 가까운 2번 산타 쪽으로 이동하게 되어 2번 산타와 충돌합니다. 2번 산타는 2점을 얻고 격자 밖으로 튕겨 나가게 됩니다.
<img width="1476" alt="07445ffb-c7a5-4b4d-b1e5-0659562b8b03" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/865271c3-fc79-430e-9038-3b49c32279c9">

<br>

### 5번 턴 - 산타

1번 산타는 루돌프 쪽으로 이동합니다. 살아남은 산타는 1번 이므로 이 산타는 턴 종료와 함께 점수 1점을 얻게 됩니다.
<img width="1446" alt="01103fa5-979e-41ad-830e-c75b570fbdce" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/52991887-72f2-49f7-9c5a-762962953c95">

<br>

### 6번 턴 - 루돌프

루돌프는 거리가 가장 가까운 1번 산타 쪽으로 이동합니다.
<img width="1476" alt="aa75f3a3-78a3-456e-a90f-76678fe52287" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/c1063021-d8e2-4895-b6af-572152c7d779">

<br>

### 6번 턴 - 산타

1번 산타는 산타와 충돌하게 되어 2점을 얻고 튕겨나가게 됩니다. 1번 산타는 7번 턴까지 기절하게 됩니다. 살아남은 산타는 1번 이므로 이 산타는 턴 종료와 함께 점수 1점을 얻게 됩니다.
<img width="1490" alt="836e76a8-5280-4b99-9c24-a805dd5cf179" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/4cf30e77-d0df-4751-bfe0-25ebeef96c5c">

<br>

### 7번 턴 - 루돌프

루돌프는 거리가 가장 가까운 1번 산타 쪽으로 이동합니다.
<img width="1476" alt="75b22e07-4193-4bfc-861d-657fc72a27dc" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/0016bfee-14f9-4983-8500-b43fea569872">

<br>

### 7번 턴 - 산타

1번 산타는 기절하게 되어 아무 일도 일어나지 않습니다.
<img width="1446" alt="7b7a3c7f-882c-476c-9fbb-9d04f96da8c0" src="https://github.com/meanzi3/codetree-TILs/assets/120402129/ef934682-343a-48e0-8cef-6f26a2d41fd9">

<br>
이제 모든 턴이 종료되었습니다. 모든 턴이 종료된 이후 각 산타가 얻게된 점수는 순서대로 11 6 2 7가 됩니다.

<br>

#### 제한

```
시간 제한: 1000ms
메모리 제한: 80MB
```

<br>

---

## 접근 방법

작성해야 하는 부분은 크게 4가지로 나눌 수 있다.

```
1. 게임판 구성

  - 게임판에서 각 산타의 번호를 저장, 루돌프는 99로 저장.


2. 루돌프 이동

  - 8가지 방향으로 이동
  - 가까운 산타가 여럿 존재할 경우, 조건에 맞도록 이동 방향 잘 설정


3. 산타 이동

  - 4가지 방향으로 이동
  - 이동 가능한 방향이 2개 이상이면, 상우하좌의 우선순위를 가짐
  - *** 이동할 수 있는 구역이 있어도, 루돌프로부터 멀어지는 위치면 이동하지 않는다.
  - 아웃되었거나 해당 판에서 기절한 상태인 산타는 움직일 수 없다.


4. 충돌 처리

  - 루돌프와 산타 간의 충돌이 발생하면 산타의 이동 발생
  - 그와 동시에 충돌한 산타는 기절하여 다음 턴은 이동할 수 없다.
  - 산타가 튕겨서 도착할 위치에 다른 산타가 있다면 연쇄적으로 1칸 밀려난다.
  - 루돌프는 산타의 기절 여부와 상관없이 가장 가까운 산타와 충돌할 수 있다.

```
